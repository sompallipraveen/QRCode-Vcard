<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>QR Contact Card Generator â€“ Sompalli & Co</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />

  <style>
    /* â”€â”€ Reset & Variables â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --navy:    #0D2B55;
      --gold:    #C9993A;
      --gold-lt: #F5C842;
      --cream:   #FAF7F2;
      --smoke:   #EDE8DF;
      --text:    #1A1A2E;
      --muted:   #6B7280;
      --border:  #D9D0C0;
      --white:   #FFFFFF;
      --radius:  12px;
      --shadow:  0 4px 24px rgba(13,43,85,.12);
      --shadow-lg: 0 12px 48px rgba(13,43,85,.18);
    }

    html { scroll-behavior: smooth; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--cream);
      color: var(--text);
      min-height: 100vh;
      background-image:
        radial-gradient(ellipse 80% 60% at 10% 0%, rgba(13,43,85,.06) 0%, transparent 60%),
        radial-gradient(ellipse 60% 40% at 90% 100%, rgba(201,153,58,.08) 0%, transparent 60%);
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      background: var(--navy);
      padding: 18px 40px;
      display: flex;
      align-items: center;
      gap: 16px;
      box-shadow: 0 2px 16px rgba(13,43,85,.3);
    }

    .logo-mark {
      width: 42px; height: 42px;
      background: linear-gradient(135deg, var(--gold), var(--gold-lt));
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-family: 'Cormorant Garamond', serif;
      font-weight: 700; font-size: 20px;
      color: var(--navy);
      flex-shrink: 0;
    }

    .brand h1 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 22px; font-weight: 700;
      color: var(--white);
      letter-spacing: .3px;
      line-height: 1.2;
    }

    .brand p {
      font-size: 11px; color: rgba(255,255,255,.55);
      letter-spacing: 1.5px; text-transform: uppercase;
    }

    .header-badge {
      margin-left: auto;
      background: rgba(201,153,58,.15);
      border: 1px solid rgba(201,153,58,.35);
      border-radius: 20px;
      padding: 6px 14px;
      font-size: 11px;
      color: var(--gold-lt);
      letter-spacing: .8px;
      text-transform: uppercase;
    }

    /* â”€â”€ Main Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 50px 24px 80px;
      display: grid;
      grid-template-columns: 1fr 420px;
      gap: 32px;
      align-items: start;
    }

    @media (max-width: 820px) {
      main { grid-template-columns: 1fr; }
    }

    /* â”€â”€ Card Shell â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .card {
      background: var(--white);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .card-header {
      background: linear-gradient(135deg, var(--navy) 0%, #1a3a6e 100%);
      padding: 22px 28px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .card-header-icon {
      width: 36px; height: 36px;
      background: rgba(201,153,58,.2);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }

    .card-header h2 {
      font-family: 'Cormorant Garamond', serif;
      font-size: 19px; font-weight: 600;
      color: var(--white);
    }

    .card-header p {
      font-size: 12px;
      color: rgba(255,255,255,.5);
    }

    .card-body { padding: 28px; }

    /* â”€â”€ Form Elements â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .form-section {
      margin-bottom: 24px;
    }

    .section-label {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1.8px;
      color: var(--muted);
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--smoke);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-label::before {
      content: '';
      width: 3px; height: 14px;
      background: var(--gold);
      border-radius: 2px;
    }

    .field-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .field-grid .full { grid-column: 1 / -1; }

    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text);
      letter-spacing: .2px;
    }

    label span { color: #E53E3E; margin-left: 2px; }

    input, textarea, select {
      width: 100%;
      padding: 10px 14px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      color: var(--text);
      background: var(--cream);
      transition: border-color .2s, box-shadow .2s, background .2s;
      outline: none;
    }

    input:focus, textarea:focus, select:focus {
      border-color: var(--navy);
      background: var(--white);
      box-shadow: 0 0 0 3px rgba(13,43,85,.08);
    }

    input::placeholder, textarea::placeholder { color: #B0A89A; }

    textarea { resize: vertical; min-height: 72px; }

    /* â”€â”€ Color Picker â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .color-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .color-opt { display: none; }

    .color-lbl {
      width: 36px; height: 36px;
      border-radius: 50%;
      cursor: pointer;
      border: 3px solid transparent;
      transition: transform .2s, border-color .2s, box-shadow .2s;
      position: relative;
    }

    .color-opt:checked + .color-lbl {
      border-color: var(--gold);
      transform: scale(1.15);
      box-shadow: 0 0 0 3px rgba(201,153,58,.25);
    }

    .color-lbl::after {
      content: '';
      position: absolute;
      inset: 3px;
      border-radius: 50%;
    }

    .c-navy   { background: #0D2B55; }
    .c-green  { background: #1A4731; }
    .c-maroon { background: #6B0F1A; }
    .c-black  { background: #111111; }
    .c-purple { background: #3B0764; }

    /* â”€â”€ Button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .btn-generate {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, var(--navy) 0%, #1a3a6e 100%);
      color: var(--white);
      border: none;
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      font-weight: 600;
      letter-spacing: .5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: transform .15s, box-shadow .15s, opacity .15s;
      box-shadow: 0 4px 16px rgba(13,43,85,.25);
    }

    .btn-generate:hover  { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(13,43,85,.3); }
    .btn-generate:active { transform: translateY(0); }
    .btn-generate:disabled { opacity: .65; cursor: not-allowed; transform: none; }

    .spinner {
      width: 18px; height: 18px;
      border: 2px solid rgba(255,255,255,.3);
      border-top-color: #fff;
      border-radius: 50%;
      animation: spin .7s linear infinite;
      display: none;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ QR Preview Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .preview-panel {
      position: sticky;
      top: 24px;
    }

    .qr-placeholder {
      aspect-ratio: 1 / 1;
      background: var(--smoke);
      border-radius: var(--radius);
      border: 2px dashed var(--border);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 14px;
      transition: all .3s;
      min-height: 300px;
    }

    .qr-placeholder svg { opacity: .25; }

    .qr-placeholder p {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
      max-width: 180px;
      line-height: 1.5;
    }

    #qr-result {
      display: none;
    }

    #qr-result img {
      width: 100%;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-lg);
      animation: fadeIn .4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(.96); }
      to   { opacity: 1; transform: scale(1);   }
    }

    .action-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 14px;
    }

    .btn-action {
      padding: 11px;
      border-radius: 9px;
      font-family: 'DM Sans', sans-serif;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 7px;
      transition: all .15s;
      border: none;
    }

    .btn-download {
      background: var(--gold);
      color: var(--navy);
      box-shadow: 0 2px 8px rgba(201,153,58,.3);
    }

    .btn-download:hover { background: var(--gold-lt); transform: translateY(-1px); }

    .btn-copy {
      background: var(--smoke);
      color: var(--text);
      border: 1.5px solid var(--border);
    }

    .btn-copy:hover { background: #E5DDD0; }

    /* vCard preview box */
    .vcard-box {
      display: none;
      margin-top: 14px;
      background: #1A1A2E;
      border-radius: 10px;
      padding: 16px;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      color: #7FC8A9;
      line-height: 1.7;
      max-height: 180px;
      overflow-y: auto;
      animation: fadeIn .3s ease;
    }

    .vcard-toggle {
      margin-top: 12px;
      text-align: center;
      font-size: 12px;
      color: var(--muted);
      cursor: pointer;
      display: none;
    }

    .vcard-toggle:hover { color: var(--navy); text-decoration: underline; }

    /* â”€â”€ Tips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .tips {
      margin-top: 18px;
      background: linear-gradient(135deg, rgba(13,43,85,.04) 0%, rgba(201,153,58,.04) 100%);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px 18px;
    }

    .tips h4 {
      font-size: 12px;
      font-weight: 600;
      color: var(--navy);
      letter-spacing: .5px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }

    .tips ul {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 7px;
    }

    .tips li {
      font-size: 12px;
      color: var(--muted);
      display: flex;
      align-items: flex-start;
      gap: 8px;
      line-height: 1.5;
    }

    .tips li::before {
      content: 'âœ“';
      color: var(--gold);
      font-weight: 700;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: fixed;
      bottom: 28px; right: 28px;
      background: var(--navy);
      color: var(--white);
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: var(--shadow-lg);
      transform: translateY(80px);
      opacity: 0;
      transition: all .3s cubic-bezier(.34,1.56,.64,1);
      z-index: 999;
    }

    #toast.show { transform: translateY(0); opacity: 1; }

    /* â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    footer {
      text-align: center;
      padding: 20px;
      font-size: 12px;
      color: var(--muted);
      border-top: 1px solid var(--border);
    }

    footer a { color: var(--navy); text-decoration: none; }
    footer a:hover { text-decoration: underline; }
  </style>
</head>

<body>

<!-- â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header>
  <div class="logo-mark">S&amp;C</div>
  <div class="brand">
    <h1>QR Contact Card Generator</h1>
    <p>Sompalli &amp; Co Â· CA Community Tool</p>
  </div>
  <div class="header-badge">vCard 3.0</div>
</header>

<!-- â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main>

  <!-- LEFT: Form -->
  <div>
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon">ğŸ‘¤</div>
        <div>
          <h2>Personal Details</h2>
          <p>Fill in the details to generate your contact QR</p>
        </div>
      </div>
      <div class="card-body">

        <!-- Basic Info -->
        <div class="form-section">
          <div class="section-label">Basic Information</div>
          <div class="field-grid">
            <div class="field full">
              <label>Full Name <span>*</span></label>
              <input type="text" id="name" placeholder="Enter full name" value="" autocomplete="name" />
            </div>
            <div class="field">
              <label>Designation / Title</label>
              <input type="text" id="title" placeholder="Enter designation" value="" />
            </div>
            <div class="field">
              <label>Organisation</label>
              <input type="text" id="org" placeholder="" value="" />
            </div>
          </div>
        </div>

        <!-- Contact -->
        <div class="form-section">
          <div class="section-label">Contact Details</div>
          <div class="field-grid">
            <div class="field">
              <label>Mobile Number</label>
              <input type="tel" id="phone" placeholder="Enter mobile number" value="" autocomplete="tel" />
            </div>
            <div class="field">
              <label>Work Phone</label>
              <input type="tel" id="phone2" placeholder="Enter work phone" value="" />
            </div>
            <div class="field full">
              <label>Email Address</label>
              <input type="email" id="email" placeholder="Enter email address" value="" autocomplete="email" />
            </div>
          </div>
        </div>

        <!-- Online -->
        <div class="form-section">
          <div class="section-label">Online Presence</div>
          <div class="field-grid">
            <div class="field full">
              <label>Website</label>
              <input type="url" id="website" placeholder="Enter website URL" value="" />
            </div>
            <div class="field full">
              <label>LinkedIn URL</label>
              <input type="url" id="linkedin" placeholder="Enter LinkedIn URL" value="" />
            </div>
          </div>
        </div>

        <!-- Extra -->
        <div class="form-section">
          <div class="section-label">Additional Info</div>
          <div class="field-grid">
            <div class="field full">
              <label>Office Address</label>
              <input type="text" id="address" placeholder="Enter office address" value="Medchal, Hyderabad, Telangana, India" />
            </div>
            <div class="field full">
              <label>Note / Tagline</label>
              <textarea id="note" placeholder="Enter a note or tagline"></textarea>
            </div>
          </div>
        </div>

        <!-- Colour -->
        <div class="form-section">
          <div class="section-label">QR Colour Theme</div>
          <div class="color-row">
            <input class="color-opt" type="radio" name="color" id="c-navy"   value="navy"   checked />
            <label class="color-lbl c-navy"   for="c-navy"   title="Navy Blue"></label>

            <input class="color-opt" type="radio" name="color" id="c-green"  value="green"  />
            <label class="color-lbl c-green"  for="c-green"  title="Forest Green"></label>

            <input class="color-opt" type="radio" name="color" id="c-maroon" value="maroon" />
            <label class="color-lbl c-maroon" for="c-maroon" title="Maroon"></label>

            <input class="color-opt" type="radio" name="color" id="c-black"  value="black"  />
            <label class="color-lbl c-black"  for="c-black"  title="Charcoal Black"></label>

            <input class="color-opt" type="radio" name="color" id="c-purple" value="purple" />
            <label class="color-lbl c-purple" for="c-purple" title="Royal Purple"></label>
          </div>
        </div>

        <!-- Generate -->
        <button class="btn-generate" id="btn-gen" onclick="generateQR()">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
            <rect x="3" y="14" width="7" height="7"/>
            <path d="M14 14h3v3M17 20v1M20 14h1v3M20 20h1"/>
          </svg>
          <span id="btn-text">Generate QR Code</span>
          <div class="spinner" id="spinner"></div>
        </button>

      </div>
    </div>
  </div>

  <!-- RIGHT: Preview -->
  <div class="preview-panel">
    <div class="card">
      <div class="card-header">
        <div class="card-header-icon">ğŸ“±</div>
        <div>
          <h2>QR Preview</h2>
          <p>Scan to auto-save contact on phone</p>
        </div>
      </div>
      <div class="card-body">

        <!-- Placeholder -->
        <div class="qr-placeholder" id="qr-placeholder">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#0D2B55" stroke-width="1.5">
            <rect x="3" y="3" width="7" height="7" rx="1"/>
            <rect x="14" y="3" width="7" height="7" rx="1"/>
            <rect x="3" y="14" width="7" height="7" rx="1"/>
            <path d="M14 14h3v3M17 20v1M20 14h1v3M20 20h1"/>
          </svg>
          <p>Your QR code will appear here after you fill in the form</p>
        </div>

        <!-- Result -->
        <div id="qr-result">
          <img id="qr-img" src="" alt="Contact QR Code" />
          <div class="action-row">
            <button class="btn-action btn-download" onclick="downloadQR()">
              â¬‡ Download PNG
            </button>
            <button class="btn-action btn-copy" onclick="copyQR()">
              ğŸ“‹ Copy Image
            </button>
          </div>
          <div class="vcard-toggle" id="vcard-toggle" onclick="toggleVcard()">
            â–¸ Show vCard Data
          </div>
          <div class="vcard-box" id="vcard-box"></div>
        </div>

      </div>
    </div>

    <!-- Tips -->
    <div class="tips">
      <h4>ğŸ“Œ How it works</h4>
      <ul>
        <li>Open your phone Camera and point it at the QR code</li>
        <li>A notification will appear â€” tap "Add Contact"</li>
        <li>All details are saved automatically to your contacts</li>
        <li>Compatible with iPhone and all Android phones</li>
        <li>Print on business cards, letterhead, or share digitally</li>
      </ul>
    </div>

  </div>
</main>

<!-- Footer -->
<footer>
  Built with â¤ï¸ for the CA Community Â·
  <a href="https://sompalliandco.com" target="_blank">Sompalli &amp; Co</a>
</footer>

<!-- Toast -->
<div id="toast">âœ“ <span id="toast-msg"></span></div>

<!-- â”€â”€ Script â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script>
  let lastData    = null;
  let vcardShown  = false;

  function getFormData() {
    return {
      name:     document.getElementById('name').value.trim(),
      title:    document.getElementById('title').value.trim(),
      org:      document.getElementById('org').value.trim(),
      phone:    document.getElementById('phone').value.trim(),
      phone2:   document.getElementById('phone2').value.trim(),
      email:    document.getElementById('email').value.trim(),
      website:  document.getElementById('website').value.trim(),
      linkedin: document.getElementById('linkedin').value.trim(),
      address:  document.getElementById('address').value.trim(),
      note:     document.getElementById('note').value.trim(),
      color:    document.querySelector('input[name="color"]:checked').value,
    };
  }

  async function generateQR() {
    const data = getFormData();
    if (!data.name) {
      showToast('âš ï¸ Please enter at least a Name');
      document.getElementById('name').focus();
      return;
    }

    lastData = data;

    // Loading state
    const btn     = document.getElementById('btn-gen');
    const spinner = document.getElementById('spinner');
    const btnText = document.getElementById('btn-text');
    btn.disabled  = true;
    spinner.style.display = 'block';
    btnText.textContent   = 'Generatingâ€¦';

    try {
      const res = await fetch('/generate', {
        method:  'POST',
        headers: {'Content-Type': 'application/json'},
        body:    JSON.stringify(data),
      });
      const json = await res.json();

      if (json.success) {
        document.getElementById('qr-placeholder').style.display = 'none';
        document.getElementById('qr-result').style.display       = 'block';
        document.getElementById('qr-img').src = 'data:image/png;base64,' + json.image;
        document.getElementById('vcard-box').textContent          = json.vcard;
        document.getElementById('vcard-toggle').style.display     = 'block';
        showToast('âœ… QR Code generated!');
      } else {
        showToast('âŒ ' + (json.error || 'Something went wrong'));
      }
    } catch (e) {
      showToast('âŒ Connection error. Is the server running?');
    } finally {
      btn.disabled             = false;
      spinner.style.display    = 'none';
      btnText.textContent      = 'Regenerate QR Code';
    }
  }

  async function downloadQR() {
    if (!lastData) return;
    const res  = await fetch('/download', {
      method:  'POST',
      headers: {'Content-Type': 'application/json'},
      body:    JSON.stringify(lastData),
    });
    const blob = await res.blob();
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href     = url;
    a.download = (lastData.name || 'contact').replace(/\s+/g, '_').toLowerCase() + '_qr.png';
    a.click();
    URL.revokeObjectURL(url);
    showToast('ğŸ“¥ QR code downloaded!');
  }

  async function copyQR() {
    const img = document.getElementById('qr-img');
    const res = await fetch(img.src);
    const blob = await res.blob();
    await navigator.clipboard.write([
      new ClipboardItem({ 'image/png': blob })
    ]);
    showToast('ğŸ“‹ Image copied to clipboard!');
  }

  function toggleVcard() {
    vcardShown = !vcardShown;
    const box    = document.getElementById('vcard-box');
    const toggle = document.getElementById('vcard-toggle');
    box.style.display    = vcardShown ? 'block' : 'none';
    toggle.textContent   = vcardShown ? 'â–¾ Hide vCard Data' : 'â–¸ Show vCard Data';
  }

  let toastTimer = null;
  function showToast(msg) {
    const toast    = document.getElementById('toast');
    document.getElementById('toast-msg').textContent = msg;
    toast.classList.add('show');
    if (toastTimer) clearTimeout(toastTimer);
    toastTimer = setTimeout(() => toast.classList.remove('show'), 3200);
  }

  // Allow Enter key on inputs to trigger generation
  document.querySelectorAll('input, textarea').forEach(el => {
    el.addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) generateQR();
    });
  });
</script>

</body>
</html>